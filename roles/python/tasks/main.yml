---
- name: Install pyenv dependencies
  dnf:
    name: "{{ item }}"
    state: present
  loop:
    - make
    - gcc
    - zlib-devel
    - bzip2
    - bzip2-devel
    - readline-devel
    - sqlite
    - sqlite-devel
    - openssl-devel
    - tk-devel
    - libffi-devel
  become: yes
  become_method: sudo

- name: Check pyenv installed
  stat: path="{{ dotfiles_home }}/.pyenv"
  register: pyenv_dir

- name: Install pyenv
  git:
    repo: 'https://github.com/pyenv/pyenv.git'
    dest: "{{ dotfiles_home }}/.pyenv"

- name: Install Python versions
  shell: |
    export PATH="{{ dotfiles_home }}/.pyenv/bin:$PATH"
    eval "$(pyenv init -)"
    pyenv install --skip-existing {{ item }}
  args:
    executable: /bin/bash
  loop: '{{ python_versions }}'

- name: Set Python global version
  shell: |
    export PATH="{{ dotfiles_home }}/.pyenv/bin:$PATH"
    pyenv global {{ python_global }}
  args:
    executable: /bin/bash

- name: Install Python tools
  shell: |
    export PATH="{{ dotfiles_home }}/.pyenv/bin:$PATH"
    eval "$(pyenv init -)"
    pip install -U setuptools pip pipenv flake8 mypy pylint
  args:
    executable: /bin/bash

- name: Link flake8 config
  file:
    src: "{{ dotfiles_root }}/roles/python/files/flake8"
    dest: "{{ dotfiles_home }}/.config/flake8"
    state: link
    force: yes

- name: Link pylint config
  file:
    src: "{{ dotfiles_root }}/roles/python/files/pylintrc"
    dest: "{{ dotfiles_home }}/.pylintrc"
    state: link
    force: yes
