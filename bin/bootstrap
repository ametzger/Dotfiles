#!/usr/bin/env bash
set -euo pipefail

if [ ! -f "${HOME}/.ssh/id_rsa" ]; then
  echo "err: install SSH credentials first."
  exit 1
fi

echo "==> Installing prerequisites..."
sudo dnf install -y git ansible

CODE_ROOT="${HOME}/proj"
DOTFILES_ROOT="${CODE_ROOT}/dotfiles"

if [ ! -d "$CODE_ROOT" ]; then
  echo "==> Creating ${CODE_ROOT}..."
  mkdir "$CODE_ROOT"
fi

if [ ! -d "${CODE_ROOT}/dotfiles" ]; then
  echo "==> Cloning dotfiles to ${DOTFILES_ROOT}..."
  git clone git@github.com:ametzger/dotfiles.git "${DOTFILES_ROOT}"
fi

echo "==> Setting up workstation..."
cd "${DOTFILES_ROOT}"
bash "${DOTFILES_ROOT}/bin/setup"
